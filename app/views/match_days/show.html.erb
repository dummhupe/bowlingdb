
  <table>
    <tr>
      <td class="label">Datum</td>
      <td class="item"><%= @match_day.formatted_match_day %></td>
    </tr>
    <tr>
      <td class="label">Beschreibung</td>
      <td class="item"><%= @match_day.category.name %></td>
    </tr>
    <tr>
      <td class="label">Ort</td>
      <td class="item"><%= @match_day.location.name %></td>
    </tr>
  </table>
  
  <% current_game = 0 %>
  <% sum = {} %>
  <% count = {} %>
  <% @match_day.game.each do |game| %>
    <% if game.number != current_game %>
      <% if current_game > 0 %>
        </table>
      <% end %>
      <% current_game = game.number %>
      <h1>Spiel <%= game.number %></h1>
      <table>
        <tr class="header">
          <th>Spieler</th>
  	  <th colspan="2">1</th>
	  <th colspan="2">2</th>
	  <th colspan="2">3</th>
	  <th colspan="2">4</th>
	  <th colspan="2">5</th>
	  <th colspan="2">6</th>
	  <th colspan="2">7</th>
	  <th colspan="2">8</th>
	  <th colspan="2">9</th>
	  <th colspan="3">10</th>
	  <th>Gesamt</th>
	  <th>Summe</th>
	  <th>&empty;</th>
        </tr>
      <% end %>
      <tr>
        <td class="player"><%= game.player.full_name %></td>
	<% 10.times do |i| %>
  	  <td class="throw1 <%= @state_mapping[game.send('frame%02d_state1' % (i+1).to_s)] %> <%= 'lastframe' if i+1 == 10 %>">
	    <% if %w(/ X).include? game.send("frame%02d_state1" % (i+1).to_s) %>
	      <%= game.send("frame%02d_state1" % (i+1).to_s) %>
	    <% elsif game.send("frame%02d_result1" % (i+1).to_s) == 0 %>
	      &ndash;
	    <% else %>
  	      <%= game.send("frame%02d_result1" % (i+1).to_s) %>
	    <% end %>
	  </td>
	  <td class="throw2 <%= @state_mapping[game.send('frame%02d_state2' % (i+1).to_s)] %> <%= 'lastframe' if i+1 == 10 %>">
	    <% if %w(/ X).include? game.send("frame%02d_state2" % (i+1).to_s) %>
	      <%= game.send("frame%02d_state2" % (i+1).to_s) %>
	    <% elsif game.send("frame%02d_result2" % (i+1).to_s) == 0 %>
	      &ndash;
	    <% else %>
	      <%= game.send("frame%02d_result2" % (i+1).to_s) %>
	    <% end %>
	  </td>
	<% end %>
	<td class="throw3 <%= @state_mapping[game.frame10_state3] %> lastframe">
	  <% if %w(/ X).include? game.frame10_state3 %>
	    <%= game.frame10_state3 %>
	  <% else %>
	    <%= game.frame10_result3 %>
	  <% end %>
	</td>
	<td class="result"><%= game.points %></td>

	<% sum[game.player.id] = count[game.player.id] = 0 unless sum.has_key? game.player.id %>
	<% sum[:overall] = 0 unless sum.has_key? :overall %>
	<% sum[game.player.id] += game.points %>
	<% sum[:overall] += game.points %>
	<% count[game.player.id] += 1 %>
	<td class="result"><%= sum[game.player.id] %></td>
	<td class="result"><%= sum[game.player.id] / count[game.player.id] %></td>
      </tr>
    <% end %>
    <tr class="overallScore">
      <td colspan="23"></td>
      <td class="overallScore"><%= sum[:overall] %></td>
      <td></td>
    </tr>
  </table>
