  <dl class="dl-horizontal">
    <dt>Datum</dt>
    <dd><%= @match_day.formatted_match_day %></dd>
  </dl>
  <dl class="dl-horizontal">
    <dt>Beschreibung</dt>
    <dd><%= @match_day.category.name %></dd>
  </dl>
  <dl class="dl-horizontal">
    <dt>Ort</dt>
    <dd><%= @match_day.location.name %></dd>
  </dl>

  <% current_game = 0 %>
  <% sum = {} %>
  <% count = {} %>
  <% @match_day.game.each do |game| %>
    <% if game.number != current_game %>
      <% if current_game > 0 %>
        </table>
      <% end %>
      <% current_game = game.number %>
      <table class="table">
        <tr>
	  <th colspan="99" class="text-left">Spiel <%= game.number %></th>
	</tr>
        <tr>
          <th>Spieler</th>
  	  <th colspan="2" class="text-center well">1</th>
	  <th colspan="2" class="text-center well">2</th>
	  <th colspan="2" class="text-center well">3</th>
	  <th colspan="2" class="text-center well">4</th>
	  <th colspan="2" class="text-center well">5</th>
	  <th colspan="2" class="text-center well">6</th>
	  <th colspan="2" class="text-center well">7</th>
	  <th colspan="2" class="text-center well">8</th>
	  <th colspan="2" class="text-center well">9</th>
	  <th colspan="3" class="text-center well">10</th>
	  <th class="text-center well">Summe</th>
	  <th class="text-center well">&empty;</th>
        </tr>
      <% end %>
      <tr>
        <td rowspan="2"><%= game.player.full_name %></td>
	<% 10.times do |i| %>
  	  <td class="text-center <%= @state_mapping[game.send('frame%02d_state1' % (i+1).to_s)] %>">
	    <% if %w(F / X).include? game.send("frame%02d_state1" % (i+1).to_s) %>
	      <%= game.send("frame%02d_state1" % (i+1).to_s) %>
	    <% elsif game.send("frame%02d_result1" % (i+1).to_s) == 0 %>
	      &ndash;
	    <% else %>
  	      <%= game.send("frame%02d_result1" % (i+1).to_s) %>
	    <% end %>
	  </td>
	  <td class="text-center <%= @state_mapping[game.send('frame%02d_state2' % (i+1).to_s)] %>">
	    <% if %w(F / X).include? game.send("frame%02d_state2" % (i+1).to_s) %>
	      <%= game.send("frame%02d_state2" % (i+1).to_s) %>
	    <% elsif game.send("frame%02d_result2" % (i+1).to_s) == 0 %>
	      &ndash;
	    <% else %>
	      <%= game.send("frame%02d_result2" % (i+1).to_s) %>
	    <% end %>
	  </td>
	<% end %>
	<td class="text-center <%= @state_mapping[game.frame10_state3] %>">
	  <% if %w(/ X).include? game.frame10_state3 %>
	    <%= game.frame10_state3 %>
	  <% elsif game.frame10_result3 == 0 %>
	    &ndash;
	  <% else %>
	    <%= game.frame10_result3 %>
	  <% end %>
	</td>

	<% sum[game.player.id] = count[game.player.id] = 0 unless sum.has_key? game.player.id %>
	<% sum[:overall] = 0 unless sum.has_key? :overall %>
	<% sum[game.player.id] += game.points %>
	<% sum[:overall] += game.points %>
	<% count[game.player.id] += 1 %>

	<td></td>
	<td></td>
      </tr>
      <tr>
	<% 1.upto(9) do |i| %>
	<td colspan="2" class="text-right well points"><%= game.points_up_to_frame(i) %></td>
	<% end %>
	<td colspan="3" class="text-right well points"><%= game.points_up_to_frame(10) %></td>
	<td class="text-center well points"><%= sum[game.player.id] %></td>
	<td class="text-center well points"><%= sum[game.player.id] / count[game.player.id] %></td>
      </tr>
    <% end %>
    <tr>
      <td colspan="22"></td>
      <td class="text-center well points"><%= sum[:overall] %></td>
    </tr>
  </table>
